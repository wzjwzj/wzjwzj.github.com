---
layout: post
title: "abic_seis"
category: "uncategorized"
tags: info
 
toc:
widget:
mathjax:
prettify:
htmlhead:
---
{% include JB/setup %}
 
<!--end_excerpt-->



+ plf_defined:        piecewise_linear_function
+ intersection:       local contain                
+ discrete_plf_span:  piecewise_linear_function     
+ t_probe:            comparator  
+ t_strip:            sparse_trace
+ probe_set_array     comparator.     


## probe_set_array
```
subroutine probe_set_array( self, strip, allow_shrink_, span_hint, factor_ )

if allow_shrink 
    shrink newspan to strip%span 
else
    newspan =union(self%span,strip%span)
end if

self%data_span=strip%span
self%span     = next_power_of_two( union(newspan,span_hint,strip%span) >= paddingfactor*dataspan%length   ) 
self%data[data_span]=array%data*factor
```



+ grid%times:     by solve  Eikonal  equation
+ grid%weights:   by uniform distribution <-> area

+
### time reference (old)

```sh
set_source_location -F<n> -L<lat>/<lon>  -T<ref_time>   
set_source_params source_eikonal_modify  -R<t0>/<x>/<y>/<z> 
                                         -M<m>/<strike0>[:<strike1>]/<dip0>[:<dip1>]/<rake>] 
                                         -H<nukl-shift-x/nukl-shift-y>[c|r]  
                                         ....
 
 
 
sub_tdsm%centroids(it)%time  =  real(psm%ref_time)   &  ! set_source_location `[-T<ref>]`                                    origin of coordinate system.
                             +  origin_time          &  ! set_source_params source_eikonal_modify  `[-R<t0>[/<x>/<y>/<z>]]`  origin of coordinate on fault on fault.
                             -  grid%center_time     &  ! time diff between center_point and hypocenter.                  
                             +  grid%times(ix,iy)    &  ! time diff reference, relative time                               
                             +  (iw-1)*0.5*risetime  &  ! offset by nw (here risetime mean length of each time window)
                             +  t_offsets(it)        &  ! offset by nsrc
```

### time reference (new)
```sh
set_source_location -F<n> -L<lat>/<lon>  -T<ref_time>
set_source_params source_eikonal_modify  -R<t0>/<x>/<y>/<z>
                                         -M<m>/<strike0>[:<strike1>]/<dip0>[:<dip1>]/<rake>]
                                         -H<nukl-shift-x/nukl-shift-y>[c|r]
                                         ....



sub_tdsm%centroids(it)%time  =  real(psm%ref_time)   &  ! set_source_location `[-T<ref>]`                                     origin of coordinate system.
                             +  origin_time          &  ! set_source_params source_eikonal_modify  `[-R<t0>[/<x>/<y>/<z>]]`   suppose this mean hypocenter time.
                             +  grid%times(ix,iy)    &  ! time diff reference, relative time
                             +  (iw-1)*0.5*risetime  &  ! offset by nw
```
